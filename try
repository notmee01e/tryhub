-- // Fluent+ (Robotic theme edition) - cleaned & fixed
-- github.com/discoart/FluentPlus | dsc.gg/hydrahub

local Services = {
    Lighting         = game:GetService("Lighting"),
    RunService       = game:GetService("RunService"),
    Players          = game:GetService("Players"),
    UserInputService = game:GetService("UserInputService"),
    TweenService     = game:GetService("TweenService"),
    TextService      = game:GetService("TextService"),
    HttpService      = game:GetService("HttpService"),
}

local LocalPlayer = Services.Players.LocalPlayer
local Mouse       = LocalPlayer:GetMouse()
local Camera      = workspace.CurrentCamera

local Mobile = not Services.RunService:IsStudio() and
    table.find({Enum.Platform.IOS, Enum.Platform.Android}, Services.UserInputService:GetPlatform()) ~= nil

local isFisch = game.GameId == 5750914919



local Themes = {
    Names = {
        "Dark", "Darker", "AMOLED", "Light", "Balloon", "SoftCream",
        "Aqua", "Amethyst", "Rose", "Midnight", "Forest", "Sunset",
        "Ocean", "Emerald", "Sapphire", "Cloud", "Grape", "Bloody",
        "Arctic", "Robotic"
    },
    
}


local Library = {
    Version     = "1.2.2",
    Theme       = "Robotic",
    UseAcrylic  = true,
    Acrylic     = true,
    Transparency = true,
    MinimizeKey = Enum.KeyCode.LeftControl,
    MinimizeKeybind = nil,
    DialogOpen  = false,
    Windows     = {},
    Window      = nil,
    GUI         = nil,
    Options     = {},
    OpenFrames  = {},
    ActiveNotifications = {},
    Themes      = Themes.Names,
    Elements    = {},
}


local MinimizerDragging = false
local MinimizerDragStart, MinimizerDragOffset
local ActiveMinimizer

local function GetActiveMinimizer()
    return Library.Minimizer
end

local function OnDragInputBegan(input)
    if not (input.UserInputType == Enum.UserInputType.MouseButton1 or
            input.UserInputType == Enum.UserInputType.Touch) then
        return
    end

    local min = GetActiveMinimizer()
    if not min or not min.Parent then return end

    MinimizerDragging   = true
    MinimizerDragStart  = Vector2.new(input.Position.X, input.Position.Y)
    MinimizerDragOffset = min.Position
    ActiveMinimizer     = min
end

local function OnDragInputEnded(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or
       input.UserInputType == Enum.UserInputType.Touch then
        MinimizerDragging   = false
        MinimizerDragStart  = nil
        MinimizerDragOffset = nil
        ActiveMinimizer     = nil
    end
end

Services.RunService.Heartbeat:Connect(function()
    if not MinimizerDragging then return end
    if not ActiveMinimizer or not ActiveMinimizer.Parent then
        MinimizerDragging = false
        return
    end

    local current = Vector2.new(Mouse.X, Mouse.Y)
    local delta   = current - MinimizerDragStart

    local newX = MinimizerDragOffset.X.Offset + delta.X
    local newY = MinimizerDragOffset.Y.Offset + delta.Y

    local vp   = Camera.ViewportSize
    local size = ActiveMinimizer.AbsoluteSize

    newX = math.clamp(newX, 0, vp.X - size.X)
    newY = math.clamp(newY, 0, vp.Y - size.Y)

    ActiveMinimizer.Position = UDim2.new(0, newX, 0, newY)
end)


function Library:CreateMinimizer(cfg)
    cfg = cfg or {}

    if Library.Minimizer and Library.Minimizer.Parent then
        return Library.Minimizer
    end

    local holder = Instance.new("Frame")
    holder.Name               = "FluentMinimizer"
    holder.BackgroundTransparency = 1
    holder.Size               = cfg.Size or UDim2.fromOffset(42, 42)
    holder.Position           = cfg.Position or UDim2.new(0.5, -21, 0.03, 0)
    holder.ZIndex             = 999999999
    holder.Parent             = Library.GUI
    holder.Visible            = cfg.Visible ~= false

    local button = Instance.new("TextButton")
    button.Name               = "MinimizeButton"
    button.Size               = UDim2.fromScale(1,1)
    button.BackgroundTransparency = 0.1
    button.AutoButtonColor    = true
    button.Text               = ""
    button.Parent             = holder

    local corner = Instance.new("UICorner")
    corner.CornerRadius       = UDim.new(0, 14)
    corner.Parent             = button

    local stroke = Instance.new("UIStroke")
    stroke.Transparency       = 0.65
    stroke.Thickness          = 1.8
    stroke.Color              = Color3.fromRGB(80, 180, 255)
    stroke.Parent             = button

    local icon = Instance.new("ImageLabel")
    icon.Name                 = "Icon"
    icon.Size                 = UDim2.fromScale(0.65, 0.65)
    icon.Position             = UDim2.fromScale(0.5, 0.5)
    icon.AnchorPoint          = Vector2.new(0.5, 0.5)
    icon.BackgroundTransparency = 1
    icon.Image                = "rbxassetid://10734897102"   
    icon.ImageColor3          = Color3.fromRGB(210, 240, 255)
    icon.Parent               = button

    -- Dragging
    button.InputBegan:Connect(OnDragInputBegan)
    button.InputEnded:Connect(OnDragInputEnded)

    -- Click to minimize / restore
    button.MouseButton1Click:Connect(function()
        task.delay(0.06, function()
            if MinimizerDragging then return end
            if Library.Window and Library.Window.Minimize then
                Library.Window:Minimize()
            end
        end)
    end)

    Library.Minimizer = holder
    return holder
end


return Library, SaveManager, InterfaceManager, Mobile
